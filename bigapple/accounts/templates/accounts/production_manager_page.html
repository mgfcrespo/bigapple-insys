{% extends 'sidebar.html' %}
{% block content %}
<div>
    <h3 class="ui dividing header">Production Dashboard</h3>

    <div>
    <div class="ui top attached tabular menu">
        <div class="active item" data-tab="first">Week of {{ today }}</div>
        <div class="item" data-tab="second">
        {% if today.month == 1 %}
            January {{ today.year }}
        {% elif today.month == 2 %}
            February {{ today.year }}
        {% elif today.month == 3 %}
            March {{ today.year }}
        {% elif today.month == 4 %}
            April {{ today.year }}
        {% elif today.month == 5 %}
            May {{ today.year }}
        {% elif today.month == 6 %}
            June {{ today.year }}
        {% elif today.month == 7 %}
            July {{ today.year }}
        {% elif today.month == 8 %}
            August {{ today.year }}
        {% elif today.month == 9 %}
            September {{ today.year }}
        {% elif today.month == 10 %}
            October {{ today.year }}
        {% elif today.month == 11 %}
            November {{ today.year }}
        {% elif today.month == 12 %}
            December {{ today.year }}
        {% endif %}
        </div>
    </div>
    <div class="ui bottom attached active tab segment" data-tab="first">
        <div style="overflow-x: scroll;">
            <table class="ui celled center aligned table">
                <thead>
                    <tr>
                        <th>Machine</th>
                        {% for a in week %}
                        <th>{{ a }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                {% for x in machines %}
                    <tr>
                        <td>
                            <a href="#">Machine {{x.machine_id}} : {{x.machine_type}}</a>
                            {% if x.state == 'OK' %}
                            <i class="green check circle outline icon"></i>
                            {% else %}
                            <i class="red times circle outline icon"></i>
                            {% endif %}
                        </td>
                        {% for b in week %}
                            <td>
                                {% for iii in this_week %}
                                    {% if iii.Start.date == b and iii.Machine == x %}

                                            <br>
                                            <a href="{% url 'production:job_order_details' iii.ID %}">Job {{ iii.ID }}</a><br>
                                            <i>Employee:</i> {{ iii.Worker }}<br>
                                            <i>RM:</i> {{ iii.Resource }}<br>
                                            {% if iii.Start.date == b %}
                                                <i>Start: </i> {{ iii.Start.hour }}:{{ iii.Start.minute }} <br>
                                            {% endif %}
                                            {% if iii.Finish.date == b %}
                                                <i>End: </i> {{ iii.Finish.hour }}:{{ iii.Finish.minute }} <br>
                                            {% endif %}
                                            <br>

                                    {% endif %}
                                {% endfor %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="ui bottom attached tab segment" data-tab="second">
        <div style="overflow-x: scroll;">
            <table class="ui celled center aligned table">
                <thead>
                    <tr>
                       <th>Machine</th>
                        {% for c in month %}
                        <th>{{ c.day }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                {% for y in machines %}
                    <tr>
                        <td>
                            <a href="#">Machine {{y.machine_id}} : {{y.machine_type}}</a>
                            {% if y.state == 'OK' %}
                            <i class="green check circle outline icon"></i>
                            {% else %}
                            <i class="red times circle outline icon"></i>
                            {% endif %}
                        </td>
                        {% for d in month %}
                            <td>
                                {% for j in this_month %}
                                    {% if j.Start.date == d and j.Machine == y %}
                                            <br>
                                            <a href="{% url 'production:job_order_details' j.ID %}">Job {{ j.ID }}</a><br>
                                            <i>Employee:</i> {{ j.Worker }}<br>
                                            <i>RM:</i> {{ j.Resource }}<br>
                                            {% if j.Start.date == d %}
                                                <i>Start: </i> {{ j.Start.hour }}:{{ j.Start.minute }} <br>
                                            {% endif %}
                                            {% if j.Finish.date == d %}
                                                <i>End: </i> {{ j.Finish.hour }}:{{ j.Finish.minute }} <br>
                                            {% endif %}
                                            <br>
                                    {% endif %}
                                {% endfor %}
                            </td>
                        {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    </div>

    <h3 class="ui dividing header">Job Order Monitoring</h3>
    <div>
        <table class="ui celled center aligned table">

            <thead>
                <tr>
                    <th>
                        Job Order ID
                    </th>
                    <th colspan="">
                        Client
                    </th>
                    <th>
                        Date Issued
                    </th>
                    <th>
                        Estimated Finish Date & Time
                    </th>
                    <th>
                        Status
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for x in JobOrder_data10 %}
                    {% for each in ideal_end %}
                        {% if x.id == each.job_order_id %}
                            {% if each.sked_out.date < now %}
                                <tr class="negative">
                                    <td>
                                        Job {{x.id}}
                                    </td>
                                    <td>
                                        {{x.client}}
                                    </td>
                                    <td>
                                        {{x.date_issued}}
                                    </td>
                                    <td>
                                        {{ each.sked_out }}
                                    </td>
                                    <td>
                                        {{x.status}}
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td>
                                        Job {{x.id}}
                                    </td>
                                    <td>
                                        {{x.client}}
                                    </td>
                                    <td>
                                        {{x.date_issued}}
                                    </td>
                                    <td>
                                        {{each.sked_out}}
                                    </td>
                                    <td>
                                        {{x.status}}
                                    </td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="5">
                        <a href="{% url 'production:job_order_list'%}">See more</a>
                    </th>
                </tr>
            </tfoot>

        </table>
    </div>


    <h3 class="ui dividing header">Inventory Dashboard</h3>
        <div style="overflow-x: scroll;">
            <div class="ui segment">
                <h4 class="ui dividing header">Raw Material Levels</h4>
                <canvas id="inventoryCanvas" width="400" height="250"></canvas>
            </div>
        </div>
    </div>

    <script>

        var thisMonth = '{{thisMonth}}'

        var month1, month2

        if (thisMonth == 1){
            month1 = 'January'
            month2 = 'December'
        }
        else if (thisMonth == 2){
            month1 = 'February'
            month2 = "January"
        }
        else if (thisMonth == 3){
            month1 = 'March'
            month2 = "February"
        }
        else if (thisMonth == 4){
            month1 = 'April'
            month2 = "March"
        }
        else if (thisMonth == 5){
            month1 = 'May'
            month2 = 'April'
        }
        else if (thisMonth == 6){
            month1 = 'June'
            month2 = 'May'
        }
        else if (thisMonth == 7){
            month1 = 'July'
            month2 = 'June'
        }
        else if (thisMonth == 8){
            month1 = 'August'
            month2 = 'July'
        }
        else if (thisMonth == 9){
            month1 = 'September'
            month2 = 'August'
        }
        else if (thisMonth == 10){
            month1 = 'October'
            month2 = 'September'
        }
        else if (thisMonth == 11){
            month1 = 'November'
            month2 = 'October'
        }
        else if (thisMonth == 12){
            month1 = 'December'
            month2 = 'November'
        }

        var ctx = document.getElementById('comparisson');
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels:[ month2 + ' {{lastYear}}', month1 + ' {{lastYear}}',  month2 + ' {{thisYear}}', month1 + ' {{thisYear}}'],
                datasets: [{
                data:[
                    parseInt('{{POs_lastMonthlastYear.count}}'),
                    parseInt('{{POs_lastYear.count}}'),
                    parseInt('{{POs_lastMonth.count}}'),
                    parseInt('{{POs.count}}'),
                ],
                backgroundColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(54, 162, 235, 1)',
                ]
                }]
            },
            options: {
                legend:{
                    display:false,
                }
            }
        });
    </script>
    <script>
        var inventory = {
          label: "Inventory Levels",
          data: ['{{ LDPE }}', '{{ LLDPE }}', '{{ HDPE }}', '{{ PP }}', '{{ PE }}', '{{ PET }}', '{{ HD }}'],
          backgroundColor: "rgba(0, 99, 132, 0.6)",
          borderWidth: 0,
          yAxisID: "y-axis-level"
        };

        var eoq = {
          label: "Economic Order Quantity",
          data: ['{{EOQ_ldpe}}', '{{EOQ_lldpe}}','{{EOQ_hpde}}','{{EOQ_pp}}','{{EOQ_pe}}','{{EOQ_pet}}','{{EOQ_hd}}',],
          backgroundColor: "rgba(99, 132, 0, 0.6)",
          borderWidth: 0,
          yAxisID: "y-axis-eoq"
        };

        var inventoryData = {
          labels: [
            "LDPE",
            "LLDPE",
            "HDPE",
            "PP",
            "PE",
            "PET",
            "HD",
          ],
          datasets: [inventory, eoq]
        };

        var chartOptions = {
          scales: {
            xAxes: [
              {
                barPercentage: 1,
                categoryPercentage: 0.6
              }
            ],
            yAxes: [
              {
                id: "y-axis-level"
              },
              {
                id: "y-axis-eoq"
              }
            ]
          }
        };

        var barChart = new Chart(inventoryCanvas, {
          type: "bar",
          data: inventoryData,
          options: chartOptions
        });
    </script>

</div>

{% endblock %}
